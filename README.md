# распределенное хранилище

версия 1.0

## описание:
данная версия приложения является реализацией распределенного хранилища

## требования:
1. Python версии не ниже 3.6
2. библиотека hashlib

## состав:
1. консольная версия локального хранилища: node.py
2. консольная версия сервера локального узла: NodeServer.py
3. консольная версия осного сервера распределенного хранилища: MainServer.py
4. консольная версия администратора сервера: administrator.py
5. модули: info.py, parse.py, singleFileController.py, MainNodeClient.py, storage_controller.py
тесты: Test_test.py

## справка по запросу локального хранилища:
использование: `node.py DIRECTORY [OPTIONS]`

узел распределенного хранилища

позиционные аргументы:
  DIRECTORY             путь до локального хранилища

опциональные аргументы:
  `-h`, `--help`            справка
  `-w KEY VALUE`, `--write KEY VALUE`
                        записывает значение VALUE по ключу KEY
                        и завершает работу.
  `-W [KEY=VALUE [KEY=VALUE ...]]`, `--write_multiple [KEY=VALUE [KEY=VALUE ...]]`
                        записывает несколько значений VALUE по ключам KEY
                        если вызвано без аргумнтов, то принемает ключи и значения
                        со стандартного ввода stdin
  `-r KEY`, `--read KEY`    выводит значение по ключу KEY и завершает работу.
  `-d KEY`, `--delete KEY`  
                        удаляет значение по ключу KEY и завершает работу.
  `-D [KEY [KEY ...]]`, `--delete_multiple [KEY [KEY ...]]`
                        удаляет нусколько значений по ключам KEY из хранилища
                        если вызвано без аргументов, то принимает ключи
                        со стандартного ввода stdin
  `-e`, `--empty`           полностью очищает хранилище и завершает работу.
  `-c KEY`, `--contains KEY`
                        выводит YES если ключ содержится в хранилище, 
			NO, если его там нет и завершает работу.
  `-l`, `--list`            выводит все ключи, содержащиеся в хранилище.
  `-i`, `-ignore_register`  если этот флаг поставлен, то игнорирует регистр
			вводимого ключа (за исключением команд -w/--write, -e/--empty,
			-l/--list, -W/--write_multiple).
  `-s`, `--silent_mode`     отключает вывод программы

## справка по запуску узла сети:

использование: `NodeServer.py [-h] [--host HOST] DIRECTORY PORT`

позиционные аргументы:
  `DIRECTORY`    путь до директории узла
  `PORT`         порт сервера

optional arguments:
  `-h`, `--help`   показывает справку
  `--host HOST`  порт хоста

## справка по запуску сервера сети:
использование: `MainServer.py [-h] [--host HOST] [-c] [-n HOST PORT] DIRECTORY PORT`

позиционные аргументы:
  `DIRECTORY`             путь до директории сервера
  `PORT`                  порт сокета

optional arguments:
  `-h`, `--help`            показывает справку
  `--host HOST`           хост сокета
  `-c`, `--create_new`	если использован, то создает новое хранилище

При создании нового сервера, в нем не будет информации об узлах. 
Подключить их можно только через администратора сети.
Между запусками сервер сохраняет информацию об узлах и при провторных запусках
будет пытаться к ним подключиться.
сервер можно обнулить, если использовать ключ -c

## справка по запуску администратора:

использование: `administrator.py [-w KEY VALUE] [-r KEY] [-e KEY] [-c INDEX]
                        [-n HOST PORT] [-s] [-d INDEX] [-i] [-h]
                        HOST PORT`

позиционные аргументы:
  `HOST`                 	хост сервера
  `PORT`                  порт сервера

опциональные аргументы:
  `-w KEY VALUE`, `--write KEY VALUE`
                        сохраняет значение VALUE по ключу KEY в распределенное хранилище
  `-r KEY`, `--read KEY`    считывает значение по ключу KEY
  `-e KEY`, `--empty KEY`  	удаляет значение по ключу KEY
  `-c INDEX`, `--connect INDEX`
                        подключается к существующему узлу сети по его индексу
  `-n HOST PORT`, `--connect_new HOST PORT`
                        добавляет новый узел в сеть по его хосту HOST и порту PORT
  `-s`, `--shut`            отключает сервер
  `-d INDEX`, `--disconnect INDEX`
                        отключает узел сети по его индексу INDEX от сервера
  `-i`, `--indexes`        	выводит список индексов активных узлов
  `-h`, `--help`

Для работы администратора необходим запущенный сервер. При первом его запуске, 
администратор должен добавить в него узлы с помощью команды

`administrator.py -n HOST PORT` при этом сервер попытается подключиться к узлу по
данным хосту и порту и присвоет ему индекс. Нумерация индексов начинается с 0

к уже существующему узлу можно подключиться по его индексу с помощью команды

`administrator.py -c INDEX`

а отключить его - с помощью команды 

`administrator.py -d INDEX`

узнать индексы подключенных узлов можно с помощью команды

`administrator.py -i`

ключ `-s` полностью отключает сервер вместе со всеми подключенными к нему узлами

## пример использования распределенного хранилища:

1. для начала необходимо проинициировать узлы локального хранилища
	для инициации узла надо создать пустую директорию, в данном примере `.\foo1`
	и выполнить команду:
	`NodeSetvet.py .\foo1 1111`
	где `1111` - это порт сокета, который будет использоваться узлом
	с помощью ключа `--host` можно указать хост узла. по умолчанию используется `localhost`
	таким же образом можно создать неограниченое количество узлов.
	2. далее необходимо запустить сервер распределенного хранилища
	для этого надо создать еще одну директорию, в данном примере `.\bar` и выполнить команду
	`MainServer.py .\bar 2222 -c`
	где `2222` - это порт сервера, по которому будут подключаться пользователи.
	при использовании ключа `--host` можно указать хост сервера. По умолчанию используется `localhost`
	ключ `-c` отвечает за создание нового сервера. При повторном запуске использование ключа `-c` приведет
	к очистке хранилища.

	**замечание: к серверу пока не подключен ни один узел. Подключить узлы сможет администратор**

3. если сервер был запущен первый раз, то к нему необходимо подключить узлы.

	это делается с помощью команды администратора:

	`administrator.py localhost 2222 -n localhost 1111`

	данная команда подключает к серверу с хостом `localhost` и портом `2222`
	узел с хостом `localhost` и портом `1111`. Сервер запомнит этот узел под индексом `0`.
	При повторном запуске сервера, он попытается автоматически подключиться к этому узлу.

	этой же командой можно подключить к серверу другие узлы. они будут сохранены под
	индексами `1`, `2` и т.д. 

	список индексов узлов, подключенных к серверу можно увидеть, использовав команду

	`administrator.py localhost 2222 -i`

	в случае, если соединение с узлом (пусть, для примера, его индекс - `0`) потеряно, можно
	заново подключиться к узлу с помощью команды

	`administrator.py localhost 2222 -c 0`

	кроме этого, можно вручную отключить узел от сервера с помощью команды

	`administrator.py localhost 2222 -d 0`

	где вместо `0` может быть индекс любого другого подключенного узла.
	при этом отключенный узел будет выключен.

	кроме этого можно отключить весь сервер. это делается с помощью команды

	`administrator.py localhost 2222 -s`

	при этом будет выключерн сервер, а также все подключенные к нему узлы.

	для взаимодействия с хранилищем можно использовать команды:

	`administrator.py localhost 2222 -w KEY VALUE`,
	`administrator.py localhost 2222 -r KEY`,
	`administrator.py localhost 2222 -e KET`.

	эти команды действут аналогично соответствующим командам локального хранилища,
	и могут быть вызваны как из `administrator.py`, так и из `client.py`
 
